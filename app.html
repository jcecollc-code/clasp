<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clasp App</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--blue:#0A66C2;--blue-dark:#004182;--blue-deep:#001B3D;--blue-light:#EAF3FF;--teal:#00B4A6;--teal-light:rgba(0,180,166,0.1);--green:#10B981;--green-light:rgba(16,185,129,0.1);--red:#EF4444;--bg:#F5F7FA;--text:#1A2332;--muted:#637B96;--light:#94A3B8;--border:#E4EBF4;--shadow:0 4px 16px rgba(0,30,80,0.08);--shadow-lg:0 16px 48px rgba(0,30,80,0.14);--radius:12px;--sidebar-w:232px;}
*{margin:0;padding:0;box-sizing:border-box;}html,body{height:100%;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);font-size:14px;-webkit-font-smoothing:antialiased;overflow:hidden;}
.auth-screen{display:none;position:fixed;inset:0;z-index:2000;background:linear-gradient(135deg,var(--blue-deep),var(--blue-dark),#00243F);align-items:center;justify-content:center;}
.auth-screen.visible{display:flex;}
.auth-box{background:white;border-radius:20px;padding:48px 40px;width:420px;text-align:center;box-shadow:var(--shadow-lg);animation:fadeUp 0.4s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.auth-logo{font-family:'Syne',sans-serif;font-size:1.8rem;font-weight:800;color:var(--blue-dark);display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:8px;}
.auth-logo-mark{width:36px;height:36px;border-radius:10px;background:var(--blue);display:flex;align-items:center;justify-content:center;}
.auth-logo-mark svg{width:18px;height:18px;}
.auth-tagline{font-size:0.9rem;color:var(--muted);margin-bottom:32px;}
.auth-tabs{display:flex;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:24px;}
.auth-tab{flex:1;padding:10px;font-size:0.85rem;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--muted);font-family:'Outfit',sans-serif;transition:all 0.15s;}
.auth-tab.active{background:var(--blue);color:white;}
.auth-form{display:flex;flex-direction:column;gap:10px;}
.auth-input{border:1.5px solid var(--border);border-radius:10px;padding:12px 14px;font-family:'Outfit',sans-serif;font-size:0.9rem;color:var(--text);outline:none;transition:border-color 0.2s;width:100%;}
.auth-input:focus{border-color:var(--blue);}
.auth-btn{background:var(--blue);color:white;border:none;border-radius:10px;padding:13px;font-family:'Outfit',sans-serif;font-size:0.92rem;font-weight:600;cursor:pointer;transition:all 0.2s;margin-top:4px;}
.auth-btn:hover{background:var(--blue-dark);}
.auth-btn:disabled{opacity:0.6;cursor:not-allowed;}
.auth-divider{display:flex;align-items:center;gap:12px;margin:4px 0;color:var(--light);font-size:0.78rem;}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border);}
.google-btn{display:flex;align-items:center;justify-content:center;gap:10px;background:white;border:1.5px solid var(--border);border-radius:10px;padding:12px;cursor:pointer;font-family:'Outfit',sans-serif;font-size:0.88rem;font-weight:500;color:var(--text);transition:all 0.2s;width:100%;}
.google-btn:hover{border-color:var(--blue);background:var(--blue-light);}
.auth-error{color:var(--red);font-size:0.78rem;padding:8px 12px;background:rgba(239,68,68,0.08);border-radius:8px;display:none;text-align:left;margin-bottom:4px;}
.auth-success{color:var(--green);font-size:0.78rem;padding:8px 12px;background:var(--green-light);border-radius:8px;display:none;text-align:left;margin-bottom:4px;}
.app{display:flex;height:100vh;}
.sidebar{width:var(--sidebar-w);background:white;border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;}
.sidebar-top{padding:20px 16px 16px;border-bottom:1px solid var(--border);}
.logo{font-family:'Syne',sans-serif;font-size:1.4rem;font-weight:800;color:var(--blue-dark);display:flex;align-items:center;gap:8px;margin-bottom:20px;}
.logo-mark{width:30px;height:30px;border-radius:8px;background:var(--blue);display:flex;align-items:center;justify-content:center;}
.logo-mark svg{width:16px;height:16px;}
.agent-trigger{width:100%;background:var(--blue-deep);border:none;border-radius:10px;padding:10px 12px;display:flex;align-items:center;gap:8px;cursor:pointer;font-family:'Outfit',sans-serif;transition:background 0.2s;}
.agent-trigger:hover{background:#0A2240;}
.agent-orb{width:20px;height:20px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--blue),var(--teal));display:flex;align-items:center;justify-content:center;}
.agent-orb svg{width:10px;height:10px;}
.agent-trigger-text{flex:1;text-align:left;}
.agent-trigger-text span:first-child{display:block;color:rgba(255,255,255,0.5);font-size:0.68rem;letter-spacing:0.5px;}
.agent-trigger-text span:last-child{display:block;color:rgba(255,255,255,0.85);font-size:0.78rem;}
.kbd{background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.4);font-size:0.65rem;padding:2px 6px;border-radius:4px;}
.sidebar-nav{flex:1;padding:12px 8px;overflow-y:auto;}
.nav-label{font-size:0.65rem;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--light);padding:8px 8px 4px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:8px;color:var(--muted);cursor:pointer;transition:all 0.15s;font-size:0.88rem;font-weight:500;}
.nav-item:hover{background:var(--blue-light);color:var(--blue);}
.nav-item.active{background:var(--blue-light);color:var(--blue);font-weight:600;}
.nav-item svg{width:16px;height:16px;flex-shrink:0;}
.sidebar-user{padding:14px 16px;border-top:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.user-av{width:34px;height:34px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--blue),var(--teal));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:0.78rem;}
.user-name{font-size:0.82rem;font-weight:600;}
.user-role{font-size:0.72rem;color:var(--muted);margin-top:1px;}
.signout-btn{margin-left:auto;background:none;border:none;cursor:pointer;color:var(--light);padding:4px;font-size:0.7rem;font-family:'Outfit',sans-serif;}
.signout-btn:hover{color:var(--red);}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.topbar{height:52px;background:white;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;flex-shrink:0;}
.page-title{font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;color:var(--blue-deep);}
.screen{display:none;flex:1;overflow-y:auto;padding:24px;}
.screen.active{display:block;}
.agent-screen{display:none;flex:1;flex-direction:column;overflow:hidden;}
.agent-screen.active{display:flex;}
.agent-header-bar{padding:16px 24px;background:white;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;flex-shrink:0;}
.agent-status{display:flex;align-items:center;gap:6px;font-size:0.8rem;color:var(--teal);font-weight:500;}
.agent-status-dot{width:7px;height:7px;border-radius:50%;background:var(--teal);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(1.3)}}
.chat-area{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px;}
.msg{display:flex;gap:10px;max-width:80%;}
.msg.user{align-self:flex-end;flex-direction:row-reverse;}
.msg-av{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:0.72rem;margin-top:2px;}
.msg-av.agent-av{background:linear-gradient(135deg,var(--blue),var(--teal));}
.msg-av.user-av{background:linear-gradient(135deg,var(--blue-dark),var(--blue));}
.msg-bubble{border-radius:14px;padding:12px 16px;font-size:0.85rem;line-height:1.65;}
.msg.agent .msg-bubble{background:white;border:1px solid var(--border);border-bottom-left-radius:4px;color:var(--text);}
.msg.user .msg-bubble{background:var(--blue);color:white;border-bottom-right-radius:4px;}
.msg-time{font-size:0.68rem;color:var(--light);margin-top:5px;}
.msg.user .msg-time{text-align:right;}
.typing-indicator{display:flex;gap:4px;align-items:center;padding:14px 16px;}
.typing-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);animation:typing 1.2s infinite;}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes typing{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-6px);opacity:1}}
.suggestion-chips{display:flex;gap:8px;flex-wrap:wrap;padding:0 24px 16px;}
.chip{background:white;border:1px solid var(--border);border-radius:20px;padding:7px 16px;font-size:0.78rem;font-weight:500;color:var(--muted);cursor:pointer;transition:all 0.15s;font-family:'Outfit',sans-serif;}
.chip:hover{background:var(--blue-light);border-color:var(--blue);color:var(--blue);}
.compose-bar{padding:16px 24px;background:white;border-top:1px solid var(--border);flex-shrink:0;}
.compose-inner{display:flex;align-items:flex-end;gap:10px;background:var(--bg);border:1.5px solid var(--border);border-radius:12px;padding:10px 14px;transition:border-color 0.2s;}
.compose-inner:focus-within{border-color:var(--blue);}
.compose-textarea{flex:1;border:none;outline:none;background:transparent;resize:none;font-family:'Outfit',sans-serif;font-size:0.9rem;color:var(--text);min-height:24px;max-height:120px;}
.compose-textarea::placeholder{color:var(--light);}
.send-btn{background:var(--blue);border:none;border-radius:8px;width:34px;height:34px;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
.send-btn:hover{background:var(--blue-dark);}
.send-btn:disabled{background:var(--border);cursor:not-allowed;}
.send-btn svg{width:15px;height:15px;}
.edit-form{display:flex;flex-direction:column;gap:12px;}
.form-row{display:flex;gap:10px;}
.form-group{display:flex;flex-direction:column;gap:5px;flex:1;}
.form-label{font-size:0.75rem;font-weight:600;color:var(--muted);}
.form-input{border:1.5px solid var(--border);border-radius:8px;padding:9px 12px;font-family:'Outfit',sans-serif;font-size:0.88rem;color:var(--text);outline:none;transition:border-color 0.2s;background:white;}
.form-input:focus{border-color:var(--blue);}
.form-textarea{min-height:80px;resize:vertical;}
.btn-save{background:var(--blue);color:white;border:none;border-radius:8px;padding:10px 24px;font-family:'Outfit',sans-serif;font-size:0.88rem;font-weight:600;cursor:pointer;align-self:flex-start;}
.btn-save:hover{background:var(--blue-dark);}
.profile-layout{display:grid;grid-template-columns:1fr 280px;gap:20px;max-width:1000px;}
.white-card{background:white;border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;}
.profile-cover{height:90px;background:linear-gradient(135deg,var(--blue-dark),var(--blue),var(--teal));}
.profile-identity{padding:0 24px 20px;}
.profile-av-wrap{margin-top:-28px;margin-bottom:8px;display:inline-block;}
.profile-av{width:56px;height:56px;border-radius:50%;border:3px solid white;background:linear-gradient(135deg,var(--blue),var(--teal));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:1.1rem;}
.profile-name{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;color:var(--blue-deep);}
.profile-headline{font-size:0.85rem;color:var(--muted);margin-top:2px;}
.profile-stats{display:flex;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin:14px 0;}
.stat-box{flex:1;padding:10px;text-align:center;border-right:1px solid var(--border);}
.stat-box:last-child{border-right:none;}
.stat-num{font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;color:var(--blue-dark);}
.stat-label{font-size:0.65rem;color:var(--muted);margin-top:2px;}
.profile-section{padding:16px 24px;border-top:1px solid var(--border);}
.section-heading{font-family:'Syne',sans-serif;font-size:0.85rem;font-weight:700;color:var(--blue-deep);margin-bottom:10px;}
.side-card{background:white;border-radius:var(--radius);border:1px solid var(--border);padding:16px;margin-bottom:14px;}
.side-title{font-family:'Syne',sans-serif;font-size:0.82rem;font-weight:700;color:var(--blue-deep);margin-bottom:10px;}
.person-card{background:white;border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;margin-bottom:10px;display:flex;gap:14px;transition:all 0.15s;}
.person-card:hover{border-color:var(--blue);box-shadow:var(--shadow);}
.person-av{width:44px;height:44px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;}
.person-name{font-size:0.9rem;font-weight:600;}
.person-role{font-size:0.78rem;color:var(--muted);margin-top:2px;}
.person-tags{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap;}
.ptag{font-size:0.68rem;font-weight:500;padding:2px 8px;border-radius:8px;background:var(--blue-light);color:var(--blue);}
.person-signal{font-size:0.72rem;color:var(--green);font-weight:500;margin-top:6px;}
.person-actions{display:flex;flex-direction:column;gap:6px;align-items:flex-end;justify-content:center;margin-left:auto;}
.btn-sm{border:none;border-radius:8px;padding:7px 14px;font-size:0.76rem;font-weight:600;cursor:pointer;font-family:'Outfit',sans-serif;transition:all 0.15s;white-space:nowrap;}
.btn-blue{background:var(--blue);color:white;}
.btn-blue:hover{background:var(--blue-dark);}
.btn-dark{background:var(--blue-deep);color:rgba(255,255,255,0.85);display:flex;align-items:center;gap:4px;}
.btn-dark:hover{background:#0A2240;}
.btn-ghost{background:var(--bg);color:var(--muted);border:1px solid var(--border);}
.btn-ghost:hover{background:var(--blue-light);color:var(--blue);border-color:var(--blue);}
.draft-card{background:white;border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;margin-bottom:10px;}
.draft-meta{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.draft-to{font-size:0.85rem;font-weight:600;}
.draft-type{font-size:0.7rem;background:var(--blue-light);color:var(--blue);padding:2px 8px;border-radius:8px;font-weight:500;}
.draft-content{font-size:0.82rem;color:var(--muted);line-height:1.6;white-space:pre-wrap;}
.draft-time{font-size:0.7rem;color:var(--light);margin-top:8px;}
.search-bar-wrap{display:flex;align-items:center;gap:8px;background:white;border:1.5px solid var(--border);border-radius:10px;padding:10px 16px;margin-bottom:16px;}
.search-bar-wrap:focus-within{border-color:var(--blue);}
.search-bar-wrap svg{width:16px;height:16px;color:var(--muted);flex-shrink:0;}
.search-input{border:none;outline:none;flex:1;font-family:'Outfit',sans-serif;font-size:0.9rem;color:var(--text);}
.search-input::placeholder{color:var(--light);}
.toast{position:fixed;bottom:24px;right:24px;z-index:999;background:var(--blue-deep);color:white;padding:12px 20px;border-radius:10px;font-size:0.85rem;font-weight:500;box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:8px;transform:translateY(80px);opacity:0;transition:all 0.3s;pointer-events:none;}
.toast.show{transform:translateY(0);opacity:1;}
.spotlight-overlay{display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,20,50,0.5);backdrop-filter:blur(4px);align-items:flex-start;justify-content:center;padding-top:12vh;}
.spotlight-overlay.open{display:flex;}
.spotlight-box{width:600px;background:white;border-radius:16px;box-shadow:var(--shadow-lg);overflow:hidden;animation:spotOpen 0.18s ease;}
@keyframes spotOpen{from{opacity:0;transform:scale(0.96) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.spot-input-row{display:flex;align-items:center;gap:10px;padding:16px 20px;border-bottom:1px solid var(--border);}
.spot-orb{width:26px;height:26px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--blue),var(--teal));display:flex;align-items:center;justify-content:center;}
.spot-orb svg{width:12px;height:12px;}
.spot-input{flex:1;border:none;outline:none;font-family:'Outfit',sans-serif;font-size:1rem;color:var(--text);}
.spot-input::placeholder{color:var(--light);}
.spot-esc{font-size:0.68rem;background:var(--bg);border:1px solid var(--border);border-radius:5px;padding:2px 7px;color:var(--muted);}
.spot-suggestions{padding:8px;}
.spot-label{font-size:0.65rem;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--light);padding:6px 10px 4px;}
.spot-item{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:8px;cursor:pointer;transition:background 0.1s;}
.spot-item:hover{background:var(--blue-light);}
.spot-icon{width:28px;height:28px;border-radius:7px;background:var(--bg);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.spot-icon svg{width:14px;height:14px;color:var(--blue);}
.spot-title{font-size:0.83rem;font-weight:500;color:var(--text);}
.spot-sub{font-size:0.72rem;color:var(--muted);margin-top:1px;}
.spot-footer{padding:8px 18px;border-top:1px solid var(--border);display:flex;gap:12px;background:var(--bg);}
.spot-hint{font-size:0.68rem;color:var(--light);display:flex;align-items:center;gap:4px;}
.spot-hint kbd{background:white;border:1px solid var(--border);border-radius:4px;padding:1px 5px;font-family:'Outfit',sans-serif;font-size:0.65rem;}
</style>
</head>
<body>

<div class="auth-screen visible" id="auth-screen">
  <div class="auth-box">
    <div class="auth-logo" onclick="window.location.href='/'" style="cursor:pointer;">
      <div class="auth-logo-mark"><svg viewBox="0 0 16 16" fill="none"><path d="M3 8h10M8 3l5 5-5 5" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
      Clasp
    </div>
    <div class="auth-tagline">Professional networking for the agent era</div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="tab-signin" onclick="switchTab('signin')">Sign In</button>
      <button class="auth-tab" id="tab-signup" onclick="switchTab('signup')">Sign Up</button>
    </div>
    <div class="auth-error" id="auth-error"></div>
    <div class="auth-success" id="auth-success"></div>
    <div class="auth-form">
      <input class="auth-input" type="email" id="auth-email" placeholder="Work email" autocomplete="email">
      <input class="auth-input" type="password" id="auth-password" placeholder="Password" autocomplete="current-password" onkeydown="if(event.key==='Enter')authSubmit()">
      <input class="auth-input" type="text" id="auth-name" placeholder="Your full name" style="display:none" autocomplete="name">
      <button class="auth-btn" id="auth-submit-btn" onclick="authSubmit()">Sign In</button>
    </div>
    <div class="auth-divider">or</div>
    <button class="google-btn" onclick="signInWithGoogle()">
      <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Continue with Google
    </button>
  </div>
</div>

<div class="app" id="app" style="display:none">
  <aside class="sidebar">
    <div class="sidebar-top">
      <div class="logo" onclick="window.location.href='/'" style="cursor:pointer;"><div class="logo-mark"><svg viewBox="0 0 16 16" fill="none"><path d="M3 8h10M8 3l5 5-5 5" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></div>Clasp</div>
      <button class="agent-trigger" onclick="openSpotlight()">
        <div class="agent-orb"><svg viewBox="0 0 24 24" fill="white"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg></div>
        <div class="agent-trigger-text"><span>Ask Claude</span><span>Your AI networking agent</span></div>
        <span class="kbd">⌘K</span>
      </button>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-label">Workspace</div>
      <div class="nav-item active" onclick="switchScreen('agent',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg>Claude Agent</div>
      <div class="nav-item" onclick="switchScreen('profile',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M6 20v-1a6 6 0 0 1 12 0v1"/></svg>My Profile</div>
      <div class="nav-item" onclick="switchScreen('search',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>Find People</div>
      <div class="nav-item" onclick="switchScreen('outreach',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Draft Outreach</div>
      <div class="nav-item" onclick="switchScreen('drafts',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Saved Drafts</div>
    </nav>
    <div class="sidebar-user">
      <div class="user-av" id="sidebar-av">?</div>
      <div><div class="user-name" id="sidebar-name">Loading…</div><div class="user-role" id="sidebar-role"></div></div>
      <button class="signout-btn" onclick="signOut()">Sign out</button>
    </div>
  </aside>

  <div class="main">
    <div class="topbar"><div class="page-title" id="page-title">Claude Agent</div></div>

    <div class="agent-screen active" id="screen-agent">
      <div class="agent-header-bar">
        <div class="agent-orb" style="width:32px;height:32px;"><svg viewBox="0 0 24 24" fill="white" width="14" height="14"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg></div>
        <div><div style="font-size:0.88rem;font-weight:600;color:var(--blue-deep);">Clasp Agent</div><div class="agent-status"><span class="agent-status-dot"></span>Ready to help</div></div>
        <div style="margin-left:auto;"><button class="btn-sm btn-ghost" onclick="clearChat()">Clear chat</button></div>
      </div>
      <div class="chat-area" id="chat-area"></div>
      <div class="suggestion-chips" id="suggestion-chips">
        <div class="chip" onclick="sendSuggestion(this)">Find VP Sales leads in fintech</div>
        <div class="chip" onclick="sendSuggestion(this)">Draft a cold outreach message</div>
        <div class="chip" onclick="sendSuggestion(this)">Write a LinkedIn connection note</div>
        <div class="chip" onclick="sendSuggestion(this)">Research a company before a call</div>
      </div>
      <div class="compose-bar">
        <div class="compose-inner">
          <textarea class="compose-textarea" id="chat-input" placeholder="Ask Claude anything about networking, leads, outreach…" rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
          <button class="send-btn" id="send-btn" onclick="sendMessage()"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
        </div>
      </div>
    </div>

    <div class="screen" id="screen-profile">
      <div class="profile-layout">
        <div>
          <div class="white-card">
            <div class="profile-cover"></div>
            <div class="profile-identity">
              <div class="profile-av-wrap"><div class="profile-av" id="profile-av-display">?</div></div>
              <div class="profile-name" id="profile-name-display">Your Name</div>
              <div class="profile-headline" id="profile-headline-display">Your title</div>
            </div>
            <div style="padding:0 24px 16px;">
              <div class="profile-stats">
                <div class="stat-box"><div class="stat-num" id="stat-chats">0</div><div class="stat-label">Claude Chats</div></div>
                <div class="stat-box"><div class="stat-num" id="stat-drafts">0</div><div class="stat-label">Drafts Saved</div></div>
                <div class="stat-box"><div class="stat-num">✦</div><div class="stat-label">AI Powered</div></div>
              </div>
            </div>
            <div class="profile-section">
              <div class="section-heading">Your Profile — Claude uses this to personalize everything</div>
              <div class="edit-form">
                <div class="form-row">
                  <div class="form-group"><label class="form-label">Full Name</label><input class="form-input" id="input-name" type="text" placeholder="Your name" oninput="updateProfileDisplay()"></div>
                  <div class="form-group"><label class="form-label">Job Title</label><input class="form-input" id="input-title" type="text" placeholder="e.g. VP of Sales" oninput="updateProfileDisplay()"></div>
                </div>
                <div class="form-row">
                  <div class="form-group"><label class="form-label">Company</label><input class="form-input" id="input-company" type="text" placeholder="Your company"></div>
                  <div class="form-group"><label class="form-label">Location</label><input class="form-input" id="input-location" type="text" placeholder="City, State"></div>
                </div>
                <div class="form-group"><label class="form-label">About You</label><textarea class="form-input form-textarea" id="input-about" placeholder="A short bio — Claude will write in your voice"></textarea></div>
                <div class="form-group"><label class="form-label">Your Ideal Customer Profile (ICP)</label><textarea class="form-input form-textarea" id="input-icp" placeholder="e.g. VP Sales at Series B+ SaaS, 50-500 employees, US-based"></textarea></div>
                <button class="btn-save" onclick="saveProfile()">Save Profile</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="side-card">
            <div class="side-title">What Claude does with your profile</div>
            <div style="font-size:0.8rem;color:var(--muted);line-height:1.9;">✦ Writes outreach in your voice<br>✦ Targets leads matching your ICP<br>✦ Personalizes every message<br>✦ Researches companies you care about</div>
          </div>
        </div>
      </div>
    </div>

    <div class="screen" id="screen-search">
      <div class="search-bar-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input class="search-input" type="text" placeholder="Search by name, company, or role…" oninput="filterPeople(this.value)">
      </div>
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="btn-sm btn-dark" onclick="askClaudeToSearch()">✦ Ask Claude to find leads for me</button>
        <button class="btn-sm btn-ghost">VP / Director</button>
        <button class="btn-sm btn-ghost">Series B+</button>
        <button class="btn-sm btn-ghost">Bay Area</button>
      </div>
      <div id="people-list">
        <div class="person-card" data-search="alex morgan vp sales stripe fintech"><div class="person-av" style="background:linear-gradient(135deg,#0A66C2,#00B4A6)">AM</div><div style="flex:1;"><div class="person-name">Alex Morgan</div><div class="person-role">VP of Sales · Stripe</div><div class="person-tags"><span class="ptag">FinTech</span><span class="ptag">Payments</span></div><div class="person-signal">● Posted about AI sales tools 2 days ago</div></div><div class="person-actions"><button class="btn-sm btn-dark" onclick="draftOutreachFor('Alex Morgan','VP of Sales at Stripe')">✦ Draft outreach</button></div></div>
        <div class="person-card" data-search="riley chen director sales notion saas"><div class="person-av" style="background:linear-gradient(135deg,#004182,#0073B1)">RC</div><div style="flex:1;"><div class="person-name">Riley Chen</div><div class="person-role">Director of Sales · Notion</div><div class="person-tags"><span class="ptag">B2B SaaS</span><span class="ptag">PLG</span></div><div class="person-signal">● Hiring 3 AEs — posted 4 days ago</div></div><div class="person-actions"><button class="btn-sm btn-dark" onclick="draftOutreachFor('Riley Chen','Director of Sales at Notion')">✦ Draft outreach</button></div></div>
        <div class="person-card" data-search="taylor kim vp revenue linear devtools"><div class="person-av" style="background:linear-gradient(135deg,#0073B1,#00B4A6)">TK</div><div style="flex:1;"><div class="person-name">Taylor Kim</div><div class="person-role">VP Revenue · Linear</div><div class="person-tags"><span class="ptag">RevOps</span><span class="ptag">Dev Tools</span></div><div class="person-signal">● Shared post on AI prospecting 6 days ago</div></div><div class="person-actions"><button class="btn-sm btn-dark" onclick="draftOutreachFor('Taylor Kim','VP Revenue at Linear')">✦ Draft outreach</button></div></div>
        <div class="person-card" data-search="morgan park head sales retool automation"><div class="person-av" style="background:linear-gradient(135deg,#1E3A5F,#0A66C2)">MP</div><div style="flex:1;"><div class="person-name">Morgan Park</div><div class="person-role">Head of Sales · Retool</div><div class="person-tags"><span class="ptag">Low-Code</span><span class="ptag">Automation</span></div><div class="person-signal">● 2 mutual connections</div></div><div class="person-actions"><button class="btn-sm btn-dark" onclick="draftOutreachFor('Morgan Park','Head of Sales at Retool')">✦ Draft outreach</button></div></div>
      </div>
    </div>

    <div class="screen" id="screen-outreach">
      <div style="max-width:700px;">
        <div style="background:white;border-radius:var(--radius);border:1px solid var(--border);padding:24px;">
          <div style="font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;color:var(--blue-deep);margin-bottom:16px;">Draft Outreach with Claude</div>
          <div class="edit-form">
            <div class="form-row">
              <div class="form-group"><label class="form-label">Recipient Name</label><input class="form-input" id="outreach-name" type="text" placeholder="e.g. Alex Morgan"></div>
              <div class="form-group"><label class="form-label">Their Role & Company</label><input class="form-input" id="outreach-role" type="text" placeholder="e.g. VP Sales at Stripe"></div>
            </div>
            <div class="form-group"><label class="form-label">Why are you reaching out?</label><textarea class="form-input form-textarea" id="outreach-reason" placeholder="e.g. Saw their post about AI, want to explore partnership…"></textarea></div>
            <div class="form-row">
              <div class="form-group"><label class="form-label">Message Type</label><select class="form-input" id="outreach-type"><option value="linkedin-connection">LinkedIn Connection Note</option><option value="linkedin-message">LinkedIn Message</option><option value="cold-email">Cold Email</option><option value="follow-up">Follow-up</option></select></div>
              <div class="form-group"><label class="form-label">Tone</label><select class="form-input" id="outreach-tone"><option value="professional">Professional</option><option value="warm">Warm & conversational</option><option value="direct">Direct & brief</option><option value="casual">Casual</option></select></div>
            </div>
            <button class="btn-save" onclick="generateOutreach()">✦ Generate with Claude</button>
          </div>
        </div>
        <div id="outreach-result" style="display:none;margin-top:16px;background:white;border-radius:var(--radius);border:1px solid var(--border);padding:24px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <div style="font-family:'Syne',sans-serif;font-size:0.9rem;font-weight:700;color:var(--blue-deep);">Generated Message</div>
            <div style="display:flex;gap:8px;">
              <button class="btn-sm btn-ghost" onclick="copyOutreach()">Copy</button>
              <button class="btn-sm btn-ghost" onclick="saveDraft()">Save Draft</button>
              <button class="btn-sm btn-blue" onclick="generateOutreach()">✦ Regenerate</button>
            </div>
          </div>
          <div id="outreach-text" style="font-size:0.88rem;line-height:1.75;color:var(--text);white-space:pre-wrap;background:var(--bg);border-radius:8px;padding:16px;"></div>
        </div>
      </div>
    </div>

    <div class="screen" id="screen-drafts">
      <div style="max-width:700px;">
        <div style="font-family:'Syne',sans-serif;font-size:1rem;font-weight:700;color:var(--blue-deep);margin-bottom:16px;">Saved Drafts</div>
        <div id="drafts-list"><div style="text-align:center;padding:48px;color:var(--light);font-size:0.88rem;">No drafts yet — generate outreach and save them here.</div></div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"><span style="color:var(--teal)">✦</span><span id="toast-msg">Done!</span></div>

<div class="spotlight-overlay" id="spotlight" onclick="if(event.target===this)closeSpotlight()">
  <div class="spotlight-box">
    <div class="spot-input-row">
      <div class="spot-orb"><svg viewBox="0 0 24 24" fill="white"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg></div>
      <input class="spot-input" id="spot-input" placeholder="Ask Claude to find leads, draft a message…" onkeydown="if(event.key==='Escape')closeSpotlight();if(event.key==='Enter')spotAction(this.value)">
      <span class="spot-esc">Esc</span>
    </div>
    <div class="spot-suggestions">
      <div class="spot-label">Quick actions</div>
      <div class="spot-item" onclick="spotAction('Find VP Sales leads at Series B SaaS companies')"><div class="spot-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></div><div><div class="spot-title">Find VP Sales leads at Series B SaaS companies</div><div class="spot-sub">Lead search</div></div></div>
      <div class="spot-item" onclick="spotAction('Draft a LinkedIn connection note for cold outreach')"><div class="spot-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><div><div class="spot-title">Draft a LinkedIn connection note</div><div class="spot-sub">Outreach</div></div></div>
      <div class="spot-item" onclick="spotAction('Write a follow-up for a prospect who went cold')"><div class="spot-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div><div><div class="spot-title">Write a follow-up for a cold prospect</div><div class="spot-sub">Outreach</div></div></div>
    </div>
    <div class="spot-footer"><span class="spot-hint"><kbd>↵</kbd> send to Claude</span><span class="spot-hint"><kbd>Esc</kbd> close</span></div>
  </div>
</div>

<script>
const{createClient}=supabase;
const sb=createClient('https://exfejbtwxqczcghwfjyw.supabase.co','sb_publishable_0wsYlW-72LC8AxHCdgavQQ_I7-lu1RC');
let currentUser=null,userProfile={},chatHistory=[],isLoading=false,currentTab='signin';

async function init(){
  if(window.location.hash==='#signup')switchTab('signup');
  const{data:{session}}=await sb.auth.getSession();
  if(session?.user)await loginSuccess(session.user);
  sb.auth.onAuthStateChange(async(event,session)=>{
    if(event==='SIGNED_IN'&&session?.user)await loginSuccess(session.user);
    else if(event==='SIGNED_OUT')showAuth();
  });
}

async function loginSuccess(user){
  currentUser=user;
  document.getElementById('auth-screen').classList.remove('visible');
  document.getElementById('app').style.display='flex';
  await loadProfile();await loadChatHistory();await loadDraftsCount();
}

function showAuth(){
  currentUser=null;
  document.getElementById('app').style.display='none';
  document.getElementById('auth-screen').classList.add('visible');
}

function switchTab(tab){
  currentTab=tab;
  document.getElementById('tab-signin').classList.toggle('active',tab==='signin');
  document.getElementById('tab-signup').classList.toggle('active',tab==='signup');
  document.getElementById('auth-submit-btn').textContent=tab==='signin'?'Sign In':'Create Account';
  document.getElementById('auth-name').style.display=tab==='signup'?'block':'none';
  document.getElementById('auth-error').style.display='none';
  document.getElementById('auth-success').style.display='none';
}

async function authSubmit(){
  const email=document.getElementById('auth-email').value.trim();
  const password=document.getElementById('auth-password').value;
  const name=document.getElementById('auth-name').value.trim();
  const btn=document.getElementById('auth-submit-btn');
  if(!email||!password){showAuthError('Please enter your email and password.');return;}
  btn.disabled=true;btn.textContent='Please wait…';
  document.getElementById('auth-error').style.display='none';
  document.getElementById('auth-success').style.display='none';
  if(currentTab==='signup'){
    const{error}=await sb.auth.signUp({email,password,options:{data:{full_name:name}}});
    if(error){showAuthError(error.message);btn.disabled=false;btn.textContent='Create Account';return;}
    const s=document.getElementById('auth-success');
    s.textContent='Account created! Check your email to confirm, then sign in.';s.style.display='block';
    btn.disabled=false;btn.textContent='Create Account';
  }else{
    const{error}=await sb.auth.signInWithPassword({email,password});
    if(error){showAuthError('Incorrect email or password.');btn.disabled=false;btn.textContent='Sign In';}
  }
}

async function signInWithGoogle(){
  await sb.auth.signInWithOAuth({provider:'google',options:{redirectTo:window.location.href}});
}
async function signOut(){await sb.auth.signOut();}
function showAuthError(msg){const e=document.getElementById('auth-error');e.textContent=msg;e.style.display='block';}

async function loadProfile(){
  const{data}=await sb.from('profiles').select('*').eq('id',currentUser.id).single();
  if(data){
    userProfile=data;
    ['name','title','company','location','about','icp'].forEach(f=>{
      const el=document.getElementById('input-'+f);if(el)el.value=data[f]||'';
    });
  }else{
    const name=currentUser.user_metadata?.full_name||currentUser.email?.split('@')[0]||'';
    document.getElementById('input-name').value=name;
    userProfile={name};
  }
  updateProfileDisplay();
}

function updateProfileDisplay(){
  const name=document.getElementById('input-name').value||'Your Name';
  const title=document.getElementById('input-title').value||'Your title';
  document.getElementById('profile-name-display').textContent=name;
  document.getElementById('profile-headline-display').textContent=title;
  document.getElementById('profile-av-display').textContent=ini(name);
  document.getElementById('sidebar-av').textContent=ini(name);
  document.getElementById('sidebar-name').textContent=name;
  document.getElementById('sidebar-role').textContent=title;
}

async function saveProfile(){
  const p={id:currentUser.id};
  ['name','title','company','location','about','icp'].forEach(f=>{
    p[f]=document.getElementById('input-'+f).value;
  });
  const{error}=await sb.from('profiles').upsert(p);
  if(error){showToast('Error saving — please try again');return;}
  userProfile=p;updateProfileDisplay();
  showToast('Profile saved! Claude will use this to personalize your experience.');
}

async function loadChatHistory(){
  const{data}=await sb.from('chats').select('*').eq('user_id',currentUser.id).order('created_at',{ascending:true}).limit(50);
  if(data&&data.length>0){
    chatHistory=data.map(r=>({role:r.role==='assistant'?'assistant':'user',content:r.content}));
    data.forEach(r=>appendMsg(r.role==='assistant'?'agent':'user',r.content,false));
    document.getElementById('suggestion-chips').style.display='none';
  }else{
    const n=(userProfile.name||currentUser.user_metadata?.full_name||'there').split(' ')[0];
    appendMsg('agent','Hi '+n+'! I\'m your Clasp Agent, powered by Claude. I can help you find leads, draft outreach, research companies, and more.\n\nWhat would you like to work on?',false);
  }
  await updateChatCount();
}

async function sendMessage(){
  const input=document.getElementById('chat-input');
  const text=input.value.trim();
  if(!text||isLoading)return;
  input.value='';autoResize(input);
  document.getElementById('suggestion-chips').style.display='none';
  appendMsg('user',text,true);
  chatHistory.push({role:'user',content:text});
  await sb.from('chats').insert({user_id:currentUser.id,role:'user',content:text});
  await callClaude();
}

async function callClaude(){
  isLoading=true;document.getElementById('send-btn').disabled=true;
  const tid=appendTyping();
  try{
    const r=await fetch('/.netlify/functions/claude',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({system:getSys(),messages:chatHistory})});
    const d=await r.json();removeTyping(tid);
    if(d.content?.[0]){
      const reply=d.content[0].text;
      appendMsg('agent',reply,true);
      chatHistory.push({role:'assistant',content:reply});
      await sb.from('chats').insert({user_id:currentUser.id,role:'assistant',content:reply});
      await updateChatCount();
    }else appendMsg('agent','Something went wrong. Please try again.',false);
  }catch(e){removeTyping(tid);appendMsg('agent','Connection error — please try again.',false);}
  isLoading=false;document.getElementById('send-btn').disabled=false;
}

async function updateChatCount(){
  const{count}=await sb.from('chats').select('*',{count:'exact',head:true}).eq('user_id',currentUser.id);
  const el=document.getElementById('stat-chats');if(el)el.textContent=Math.floor((count||0)/2);
}

async function clearChat(){
  chatHistory=[];
  await sb.from('chats').delete().eq('user_id',currentUser.id);
  document.getElementById('chat-area').innerHTML='';
  document.getElementById('suggestion-chips').style.display='flex';
  const n=(userProfile.name||'there').split(' ')[0];
  appendMsg('agent','Chat cleared! What would you like to work on, '+n+'?',false);
}

function getSys(){
  const p=userProfile;
  return 'You are the Clasp Agent — an AI-powered professional networking assistant.\nHelping '+( p.name||'a professional')+', '+(p.title||'a professional')+' at '+(p.company||'their company')+', '+(p.location||'their city')+'.\nAbout: '+(p.about||'')+'\nICP: '+(p.icp||'')+'\nHelp with: finding leads, drafting outreach, researching companies, networking strategy. Keep responses practical and human. Sign outreach from '+(p.name||'the user')+'.';
}

async function generateOutreach(){
  const name=document.getElementById('outreach-name').value;
  const role=document.getElementById('outreach-role').value;
  const reason=document.getElementById('outreach-reason').value;
  const type=document.getElementById('outreach-type').value;
  const tone=document.getElementById('outreach-tone').value;
  if(!name||!reason){showToast('Please fill in recipient and reason');return;}
  const rd=document.getElementById('outreach-result');const td=document.getElementById('outreach-text');
  rd.style.display='block';td.textContent='Generating…';
  const p=userProfile;
  const prompt='Write a '+type.replace('-',' ')+' from '+(p.name||'me')+' ('+(p.title||'')+' at '+(p.company||'')+') to '+name+(role?' ('+role+')':'')+'. Reason: '+reason+'. Tone: '+tone+'.\n'+(type==='linkedin-connection'?'Keep under 300 characters.':'Keep it concise and human.')+'\nJust write the message itself, no preamble.';
  try{
    const r=await fetch('/.netlify/functions/claude',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({system:getSys(),messages:[{role:'user',content:prompt}]})});
    const d=await r.json();td.textContent=d.content?.[0]?.text||'Something went wrong.';
  }catch(e){td.textContent='Error — please try again.';}
}

async function saveDraft(){
  const name=document.getElementById('outreach-name').value;
  const role=document.getElementById('outreach-role').value;
  const type=document.getElementById('outreach-type').value;
  const content=document.getElementById('outreach-text').textContent;
  if(!content||content==='Generating…')return;
  await sb.from('drafts').insert({user_id:currentUser.id,recipient_name:name,recipient_role:role,message_type:type,content});
  showToast('Draft saved!');await loadDraftsCount();
}

async function loadDraftsCount(){
  const{count}=await sb.from('drafts').select('*',{count:'exact',head:true}).eq('user_id',currentUser.id);
  const el=document.getElementById('stat-drafts');if(el)el.textContent=count||0;
}

async function loadDraftsList(){
  const{data}=await sb.from('drafts').select('*').eq('user_id',currentUser.id).order('created_at',{ascending:false});
  const list=document.getElementById('drafts-list');
  if(!data||data.length===0){list.innerHTML='<div style="text-align:center;padding:48px;color:var(--light);font-size:0.88rem;">No drafts saved yet.</div>';return;}
  list.innerHTML=data.map(d=>'<div class="draft-card"><div class="draft-meta"><div class="draft-to">To: '+d.recipient_name+(d.recipient_role?' · '+d.recipient_role:'')+' </div><span class="draft-type">'+((d.message_type||'').replace('-',' '))+'</span></div><div class="draft-content">'+d.content+'</div><div class="draft-time">'+new Date(d.created_at).toLocaleDateString()+'</div></div>').join('');
}

function copyOutreach(){navigator.clipboard.writeText(document.getElementById('outreach-text').textContent).then(()=>showToast('Copied!'));}
function draftOutreachFor(name,role){switchScreen('outreach',document.querySelectorAll('.nav-item')[3]);setTimeout(()=>{document.getElementById('outreach-name').value=name;document.getElementById('outreach-role').value=role;},50);}
function askClaudeToSearch(){switchScreen('agent',document.querySelectorAll('.nav-item')[0]);setTimeout(()=>{document.getElementById('chat-input').value='Find me leads matching my ICP: '+(userProfile.icp||'VP Sales at Series B+ SaaS');sendMessage();},100);}
function filterPeople(q){document.querySelectorAll('.person-card').forEach(c=>{c.style.display=c.dataset.search?.includes(q.toLowerCase())?'flex':'none';});}

function appendMsg(role,text,scroll){
  const area=document.getElementById('chat-area');
  const isAgent=role==='agent'||role==='assistant';
  const time=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  const initials=ini(userProfile.name||currentUser?.email||'U');
  const div=document.createElement('div');div.className='msg '+(isAgent?'agent':'user');
  div.innerHTML='<div class="msg-av '+(isAgent?'agent-av':'user-av')+'">'+(isAgent?'<svg viewBox="0 0 24 24" fill="white" width="12" height="12"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg>':initials)+'</div><div><div class="msg-bubble">'+fmt(text)+'</div><div class="msg-time">'+time+'</div></div>';
  area.appendChild(div);if(scroll)area.scrollTop=area.scrollHeight;
}

function fmt(t){return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');}

function appendTyping(){
  const area=document.getElementById('chat-area');const id='t'+Date.now();const div=document.createElement('div');
  div.className='msg agent';div.id=id;
  div.innerHTML='<div class="msg-av agent-av"><svg viewBox="0 0 24 24" fill="white" width="12" height="12"><path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6L12 2z"/></svg></div><div class="msg-bubble"><div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>';
  area.appendChild(div);area.scrollTop=area.scrollHeight;return id;
}
function removeTyping(id){document.getElementById(id)?.remove();}

function switchScreen(name,el){
  document.querySelectorAll('.screen,.agent-screen').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('screen-'+name)?.classList.add('active');
  if(el)el.classList.add('active');
  const titles={agent:'Claude Agent',profile:'My Profile',search:'Find People',outreach:'Draft Outreach',drafts:'Saved Drafts'};
  document.getElementById('page-title').textContent=titles[name]||name;
  if(name==='drafts')loadDraftsList();
}

function sendSuggestion(el){document.getElementById('chat-input').value=el.textContent;sendMessage();}
function handleKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}}
function autoResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,120)+'px';}
function ini(name){return(name||'U').split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);}
function openSpotlight(){document.getElementById('spotlight').classList.add('open');setTimeout(()=>document.getElementById('spot-input').focus(),50);}
function closeSpotlight(){document.getElementById('spotlight').classList.remove('open');}
function spotAction(text){if(!text.trim())return;closeSpotlight();document.getElementById('spot-input').value='';switchScreen('agent',document.querySelectorAll('.nav-item')[0]);setTimeout(()=>{document.getElementById('chat-input').value=text;sendMessage();},100);}
function showToast(msg){const t=document.getElementById('toast');document.getElementById('toast-msg').textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}
document.addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();openSpotlight();}if(e.key==='Escape')closeSpotlight();});
init();
</script>
</body>
</html>
